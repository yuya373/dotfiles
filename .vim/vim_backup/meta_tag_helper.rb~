# -*- coding: utf-8 -*-
module MetaTagHelper
  def set_meta_tags_from_dataset(dataset)
    dataset.each do |key, value|
      set_meta_tags key => value
    end
  end

  def default_meta_dataset()
    return {
      :site           => APP_CONFIG['default_site'],
      :title          => APP_CONFIG['default_title'],
      :keywords       => APP_CONFIG['meta_keywords'],
      :description    => APP_CONFIG['meta_description'],
      :reverse        => APP_CONFIG['default_reverse']
    }
  end

  def make_listing_page_keywords(model)
    model.station_name + "駅,レンタルスペース,貸し会議室"
    # station      = model.station_name  + "駅"
    # preferecture = "東京"  #FIXME
    # return model.title + ", " + station + ", " + preferecture + ", " + APP_CONFIG['listing_keywords']
  end

  def set_top_page_meta_tags()
    dataset = default_meta_dataset().merge(APP_CONFIG['seo_landing'])
    set_meta_tags_from_dataset(dataset)
  end

  def set_misc_page_meta_tags(title = nil)
    dataset = default_meta_dataset()
    if title.present?
      dataset['title'] = title
    end
    set_meta_tags_from_dataset(dataset)
  end

  def set_collection_meta_tags(collection)
    dataset = default_meta_dataset()
    dataset['title']       = collection.meta_title
    dataset['keywords']    = collection.meta_keyword
    dataset['description'] = collection.meta_description
    dataset['site']        = ''
    set_canonical_tags
    set_meta_tags_from_dataset(dataset)
  end

  #TODO relationたどるのやめる
  def set_listing_page_meta_tags(model)
    dataset = default_meta_dataset()
    dataset['title']       = model.title
    dataset['keywords']    = make_listing_page_keywords(model)
    # dataset['description'] = model.title + APP_CONFIG['listing_desc_suffix']
    dataset['description'] = model.station_name + "のレンタルスペース・貸し会議室。" + model.desc
    dataset['og'] = {
     :title       => model.title,
     :type        => 'listing',
     :image       => model.thumb_url,
     :url         => request.url,
     :description => model.desc,
     :site_name   => APP_CONFIG['default_site'],
    }
    set_canonical_tags
    set_meta_tags_from_dataset(dataset)
  end

  def set_listing_price_meta_tags(model)
    dataset = default_meta_dataset()
    title_fragments = model.title.split("｜")
    listing_title = (title_fragments.length > 0) ? title_fragments[0] : model.title
    dataset['title'] = "利用料金 " + listing_title
    dataset['keywords']    = "利用料金,レンタルスペース,貸し会議室," + model.provider.name
    dataset['description'] = listing_title + "の利用料金ページです。空室確認や予約も、こちらから簡単に行って頂けます。"
    set_meta_tags_from_dataset(dataset)
  end

  def set_listing_calendar_meta_tags(model)
    dataset = default_meta_dataset()
    title_fragments = model.title.split("｜")
    listing_title = (title_fragments.length > 0) ? title_fragments[0] : model.title
    dataset['title'] = "空室カレンダー " + listing_title
    dataset['keywords']    = "空室状況,レンタルスペース,貸し会議室," + model.provider.name
    dataset['description'] = listing_title + "の空室カレンダーです。ご希望の日時の空室状況の確認や予約を簡単に行って頂けます。"
    set_canonical_tags
    set_meta_tags_from_dataset(dataset)
  end

  def set_listing_availability_meta_tags(model)
    dataset = default_meta_dataset()
    title_fragments = model.title.split("｜")
    listing_title = (title_fragments.length > 0) ? title_fragments[0] : model.title
    dataset['title'] = "空室確認 " + listing_title
    dataset['keywords']    = "空室確認,レンタルスペース,貸し会議室," + model.provider.name
    dataset['description'] = listing_title + "の空室状況を日時指定で確認できます。予約もサイト上で簡単に行って頂けます。"
    set_meta_tags_from_dataset(dataset)
  end

  def set_listing_reviews_meta_tags(model)
    dataset = default_meta_dataset()
    title_fragments = model.title.split("｜")
    listing_title = (title_fragments.length > 0) ? title_fragments[0] : model.title
    dataset['title'] = "口コミ・感想 " + listing_title
    dataset['keywords']    = "口コミ,レンタルスペース,貸し会議室"
    dataset['description'] = listing_title + "のレンタルスペース・貸し会議室に寄せられた口コミ・感想の一覧ページです。"
    set_meta_tags_from_dataset(dataset)
  end

  def set_provider_pitch_meta_tags(title)
    dataset = default_meta_dataset()
    dataset['keywords']    = APP_CONFIG['provider_meta_keywords']
    dataset['description'] = APP_CONFIG['provider_meta_description']
    dataset['title']    = title
    set_meta_tags_from_dataset(dataset)
  end

  def set_error_page_meta_tags(title)
    dataset = default_meta_dataset()
    dataset["reverse"] = true
    if title.present?
      dataset['title'] = title
    end
    set_meta_tags_from_dataset(dataset)
  end

  def set_neighborhood_page_meta_tags(neighborhood)
    dataset = default_meta_dataset()
    dataset['title'] = neighborhood.name + "のレンタルスペース・貸し会議室"
    dataset['description'] = neighborhood.name + "のレンタルスペース・貸し会議室の一覧です。少人数で１時間だけの利用も可能です！"
    dataset['keywords'] = neighborhood.name + ",レンタルスペース,貸し会議室,東京"
    set_meta_tags_from_dataset(dataset)
  end

  def set_index_meta_tags(d)
    dataset = default_meta_dataset()
    dataset = set_dataset_from_hash(dataset, d)
    set_meta_tags_from_dataset(dataset)
  end

  def set_show_meta_tags(name, d)
    dataset = default_meta_dataset()
    dataset["title"] = name + d["title"]
    dataset["keywords"] = name + "," + d["keywords"]
    dataset["description"] = name + d["description"]
    set_meta_tags_from_dataset(dataset)
  end

  def set_station_index_meta_tags
    set_index_meta_tags(APP_CONFIG['seo_station_index'])
  end

  def set_station_show_meta_tags(station)
    set_show_meta_tags(station.station_name, APP_CONFIG["seo_station_show"])
  end

  def set_line_index_meta_tags
    set_index_meta_tags(APP_CONFIG['seo_line_index'])
  end

  def set_line_show_meta_tags(line)
    set_show_meta_tags(line.line_name, APP_CONFIG["seo_line_show"])
  end

  def set_provider_user_registration_meta_tags()
    dataset = default_meta_dataset()
    dataset['title'] = "新規登録"
    set_meta_tags_from_dataset(dataset)
  end

  def set_provider_user_signin_meta_tags()
    dataset = default_meta_dataset()
    dataset['title'] = "ログイン"
    set_meta_tags_from_dataset(dataset)
  end

  def set_new_password_meta_tags()
    dataset = default_meta_dataset()
    dataset['title'] = "パスワードを再設定"
    set_meta_tags_from_dataset(dataset)
  end

  def set_unconfirmed_meta_tags()
    dataset = default_meta_dataset()
    dataset['title'] = "仮登録完了"
    set_meta_tags_from_dataset(dataset)
  end

  def set_resend_confirmation_meta_tags()
    dataset = default_meta_dataset()
    dataset['title'] = "確認メールを再送"
    set_meta_tags_from_dataset(dataset)
  end

  def set_new_listing_meta_tags()
    dataset = default_meta_dataset()
    dataset['title'] = "スペースを登録"
    set_meta_tags_from_dataset(dataset)
  end

  def set_edit_listing_meta_tags()
    dataset = default_meta_dataset()
    dataset['title'] = "スペースを編集"
    set_meta_tags_from_dataset(dataset)
  end

  def set_prebooking_form_meta_tags()
    dataset = default_meta_dataset()
    dataset['title'] = "スペースを仮予約"
    set_meta_tags_from_dataset(dataset)
  end

  def set_prebooking_success_meta_tags()
    dataset = default_meta_dataset()
    dataset['title'] = "仮予約完了"
    set_meta_tags_from_dataset(dataset)
  end

  def set_page_meta_tags(title)
    dataset = default_meta_dataset()
    dataset['title'] = title
    set_meta_tags_from_dataset(dataset)
  end

  def set_dataset_from_hash(dataset, d)
    dataset["title"]       = d["title"]
    dataset["keywords"]    = d["keywords"]
    dataset["description"] = d["description"]
    dataset
  end

  private

  def set_canonical_tags
    set_meta_tags canonical: url_for(only_path: false)
  end
end
