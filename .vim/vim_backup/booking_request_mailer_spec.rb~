require "spec_helper"

describe BookingRequestMailer do
  let(:user){ create :user }
  let(:listing){ create :d_listing, provider: create(:provider) }
  let(:booking_request){ create :booking_request,
    start_at: Time.parse("9:00") + 1.day,
    listing: listing, user: user }

  describe "#ask" do
    subject{ BookingRequestMailer.ask(booking_request.id) }
    it do
      should deliver_to(listing.email)
    end
    it do
      should have_body_text(listing.title)
    end
  end
  describe "#accept" do
    subject{ BookingRequestMailer.accept(booking_request.id) }
    it do
      should deliver_to(user.email)
    end
    it do
      should have_body_text(user.name)
      should have_body_text listing_url(listing.id)
    end
  end
  describe "#deny" do
    subject{ BookingRequestMailer.deny(booking_request.id) }
    it do
      should deliver_to(user.email)
    end
    it do
      should have_body_text(user.name)
    end
  end
  describe "#confirmation_for_user" do
    subject{ BookingRequestMailer.confirmation_for_user(booking_request.id) }
    it do
      should deliver_to(user.email)
    end
    it do 
      should have_body_text(user.name)
    end
  end
end
