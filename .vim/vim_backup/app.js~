
define([
    "react"
  ],
  function(React) {
  return {
    components: null,

    run: function(pkg, components, reactComponents, handler) {
      React.initializeTouchEvents(true);
      this.pkg = pkg;
      handler();
      this.installComponents(components);
      this.installReactComponents(reactComponents);
      this.ready();
    },
    installComponents: function(components) {
      if(!components) { return; }
      var uis = {},
          c, id, config, _c;
      for(var i=0; i<components.length; i++) {
        c = components[i];
        if(c == undefined) { continue; }
        id = c['id'];
        config = {
          el:$(document).find("[id=" + id +"]").filter(':first'),
          id:id,
          data:c['data'] || {},
          props:c['props'] || {}
        };
        _c = new this.pkg["components"][c['cmp']](config);
      }
    },
    installReactComponents: function(components) {
      if(!components || components.length == 0){ return; }
      var uis = {},
          c, id, config, _c;
      for(var i=0; i<components.length; i++) {
        c = components[i];
        if(c == undefined) { continue; }
        _c = this.pkg["components"][c['cmp']];
        React.renderComponent(
          _c({
            "data"        :c['data']  || {},
            "properties"  :c['props'] || {}
          }),
          document.getElementById(c['id'])
        );
      }
    },
    ready: function() {
      $.optimizeForMobile();
      $(document).trigger({
        "type":"appready"
      });
    }
  };
});
