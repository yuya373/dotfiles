/** @jsx React.DOM */

define([
    "react",
    "components/mixins/DatetimeHelper"
  ], function(React, DatetimeHelper) {
  var SlotsManager = React.createClass({
    getInitialState: function() {
      return {"days":this.props.days};
    },
    render: function() {
      // console.log("days", this.state.days)
      if(!_.isArray(this.state.days) || this.state.days.length == 0) {
        return <div></div>;
      }
      return (
        <div>
          <table className="schedule-slots-manager">
            <thead>
              <tr>
                <th className="cell-margin th-day-label"></th>
                {this.state.days.map(this.makeDayColumn)}
              </tr>
            </thead>
          </table>
        </div>
      );
    },
    makeDayColumn: function(day, index) {
      if(day.isOpen !== true) {
        return <th className="cell-day th-label th-day-label">休日</th>;
      }
      return (
        <th className="cell-day th-label th-day-label" key={index}>
          <a data-index={index} onClick={this.fillBlank}>空白→空室</a>
        </th>
      );

    },
    fillBlank: function(e) {
      var $target = $(e.target),
          index   = $target.prop("dataset").index,
          date    = this.state.days[index].date;
      this.props.onFillBlank({
        "state": "available",
        "date" : date
      });
    },
    // Stateful - business hour update
    dayDidUpdate: function(day, index) {
      var days    = this.state.days.slice(0);
      days[index] = day;
      this.setState({"days":days});
    },
    // Stateful - pager
    weekDidUpdate: function(days) {
      this.setState({"days":days});
    }
  });

  return SlotsManager;
});
