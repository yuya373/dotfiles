# == Schema Information
#
# Table name: lines
#
#  id           :integer          not null, primary key
#  company_cd   :integer          not null
#  line_name    :string(255)      not null
#  line_name_k  :string(255)      not null
#  line_name_h  :string(255)      not null
#  line_color_c :string(255)
#  line_color_t :string(255)
#  line_type    :string(255)
#  lon          :float            not null
#  lat          :float            not null
#  zoom         :integer          not null
#  e_status     :integer          not null
#  e_sort       :integer          not null
#  created_at   :datetime
#  updated_at   :datetime
#

class Line < ActiveRecord::Base
  has_many :stations

  scope :tokyo, ->{
    pref_is([11,12,13,14])
  }

  scope :pref_is, ->(pref_cd){
    # station = Station.arel_table
    # where Station.where(station[:pref_cd].eq(pref_cd).
    #                     and(station[:line_id].eq(arel_table[:id]))).exists
    where(id: Station.where(pref_cd: pref_cd).pluck(:line_id).uniq)
  }
  scope :available, ->{
    joins(:stations).merge(Station.published_listing_exists)
  }
  # scope :pref_is, ->(pref_cd){
    # merge(Station.where(pref_cd: pref_cd))
  # }
end
