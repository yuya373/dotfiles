require 'rubygems'
require 'nokogiri'
require 'open-uri'
require 'csv'

num = 0

(  )
con = []
while num < 200
  url = "http://rental-cafe.com/detail.html&id=#{num}"

  begin
    doc = Nokogiri::HTML(open(url))
  rescue
    next
  end
  title = doc.css('h2.tit').text
  area = doc.css('p.area').text
  info = doc.css('table.tb')
  th = info.css('th')

  space_info = []
  space_info << title
  th.each do |th|
    cont = th.text
    case cont
    when "利用目的"
      text =  th.next.next.text.gsub(/\r\n/,'')
      space_info << th.next.next.text
    when "住所"
      space_info << th.next.next.text
    when "電話番号"
      space_info << th.next.next.text
    when "メールアドレス"
      space_info << th.next.next.text
    when "設備"
      space_info << th.next.next.text.gsub(/\r\n/, '')
    when "Webサイト"
      space_info << th.next.next.text
    end
  end
  con << space_info

  p num
  num += 1
end

CSV.open('rental_cafe.csv', 'wb', headers: true) do |csv|
  header = %w(title usage address tel email equipment url)
  csv << header
  con.each do |row|
    csv << row if row.size > 1
  end
end
