# スタジオ名、電話番号、所在地、URL

require 'rubygems'
require 'nokogiri'
require 'open-uri'
require 'csv'

num = 1
com_info = []
while num < 20
  p num
  url = "http://studio-navi.jp/pc/dtl/#{sprintf("%04d", num)}.html"

  begin
    doc = Nokogiri::HTML(open(url))
  rescue
  end

  if doc
    info = []
    info << title = doc.css('h1').text
    info << tel = doc.css('td.f18b').text.tr("TEL : ",'')

    base_info = doc.css('div#base-info td').each do |td|
      case td.text
      when "所在地"
        info << address = td.next.next.text
      when "サイト"
        info << url = td.next.next.text
      end
    end

    com_info << info
  end
  num += 1
end

com_info.uniq!{|item| item[3]}

CSV.open('sutudio_navi.csv', 'wb', headers: true) do |csv|
  csv << %w(title tel address url)
  com_info.each do |info|
    csv << info
  end
end
