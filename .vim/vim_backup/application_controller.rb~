# -*- coding: utf-8 -*-
class ApplicationController < ActionController::Base
  include Jpmobile::ViewSelector
  # Basic auth for staging
  http_basic_authenticate_with name: 'spacee', password: 'spacee604' if Rails.env.staging?
  include ApplicationHelper
  include ReviewHelper
  # Prevent CSRF attacks by raising an exception.
  # For APIs, you may want to use :null_session instead.
  protect_from_forgery with: :exception

  before_action :redirect_if_unsupport_ua
  before_action :disable_mobile_view_if_tablet
  before_action :start_castro

  private

  def redirect_if_unsupport_ua
    if (ie?(user_agent.browser) && user_agent.version < "9") ||
        old_android? || ( user_agent.browser == 'Safari' && user_agent.version > "6" )
      redirect_to "/unsupport.html"
      return
    end
  end

  def disable_mobile_view_if_tablet
    if request.mobile && request.mobile.tablet?
      disable_mobile_view!
    end
  end

  def start_castro
    $castro.start()
  end

  def mobile_request?
    request.mobile? || request.smart_phone?
  end

  def kpi_logger
    Logger.new('log/search.log')
  end
end
