class ProviderScheduleMailer < ActionMailer::Base
  layout "mail"
  default from: APP_CONFIG["mail"]["info"]
  helper ApplicationHelper

  def send_to_provider(listing_ids)
    set_provider(listing_ids)
  end

  def set_provider(listing_ids)
    listings = Listing.where(id: lisitng_ids)
    providers = listings.map(&:provider).uniq

    providers.each do |provider|
      provider_listings = listings.merge(Listing.where(provider_id: provider.id))

      send_remind_mail(provider, provider_listings)
    end
  end

  def send_remind_mail(provider, listings)
    @provider = provider
    @listings = listings
provider schedule mailer    mail subject: 'スペースの空室情報を入力してください', to: @provider.email, bcc: bcc
  end

  def bcc
    [ APP_CONFIG["mail"]["mail"] ]
  end

end
