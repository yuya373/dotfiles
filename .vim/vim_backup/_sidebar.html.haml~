.ls-sidebar-legend
  %h5 エリア
.ls-sidebar
  .ls-sidebar-body
    .dropdown
      %p= link_to "東京都", search_listings_path(keeped_query.merge(prefecture: "tokyo").delete_if{|k,v| k == 'neighborhood' || k == 'station'})
      - if keeped_query[:prefecture]  == 'tokyo'
        - neighborhoods = Neighborhood.joins(:stations).merge(Station.published_listing_exists).merge(Station.prefecture_is(keeped_query[:prefecture]))
        %ul
          - neighborhoods.each do |nei|
            %li= link_to nei.name, search_listings_path(keeped_query.merge(neighborhood: nei.key).delete_if{|k,v| k == 'station'})
            - if keeped_query[:neighborhood] == nei.key
              %ul
                - nei.stations.select('station_name, stations.station_g_cd').distinct('stations.station_g_cd').each do |station|
                  %li= link_to "#{ station.station_name }駅", search_listings_path(keeped_query.merge(station: station.station_g_cd))
      %p= link_to "埼玉県", search_listings_path(keeped_query.merge(prefecture: "saitama").delete_if{|k,v| k == 'neighborhood' || k == 'station'})
      - if keeped_query[:prefecture] == 'saitama'
        -# - neighborhoods = Neighborhood.joins(:stations).merge(Station.published_listing_exists).merge(Station.prefecture_is(keeped_query[:prefecture]))
        -# - neighborhoods = Neighborhood.joins(:stations).merge(Station.prefecture_is(keeped_query[:prefecture]))
        %ul
          - neighborhoods.each do |nei|
            %li= link_to nei.name, search_listings_path(keeped_query.merge(neighborhood: nei.key).delete_if{|k,v| k == 'station'})
            - if keeped_query[:neighborhood] == nei.key
              %ul
                - nei.stations.select('station_name, stations.station_g_cd').distinct('stations.station_g_cd').each do |station|
                  %li= link_to "#{ station.station_name }駅", search_listings_path(keeped_query.merge(station: station.station_g_cd))
      %p= link_to "神奈川県", search_listings_path(keeped_query.merge(prefecture: "kanagawa").delete_if{|k,v| k == 'neighborhood' || k == 'station'})
      - if keeped_query[:prefecture] == 'kanagawa'
        - neighborhoods = Neighborhood.joins(:stations).merge(Station.published_listing_exists).merge(Station.prefecture_is(keeped_query[:prefecture]))
        %ul
          - neighborhoods.each do |nei|
            %li= link_to nei.name, search_listings_path(keeped_query.merge(neighborhood: nei.key).delete_if{|k,v| k == 'station'})
            - if keeped_query[:neighborhood] == nei.key
              %ul
                - nei.stations.select('station_name, stations.station_g_cd').distinct('stations.station_g_cd').each do |station|
                  %li= link_to "#{ station.station_name }駅", search_listings_path(keeped_query.merge(station: station.station_g_cd))


.ls-sidebar-legend
  %h5 人数
.ls-sidebar
  .ls-sidebar-body
    %ul
      %li= link_to "1〜10人", search_listings_path(keeped_query.merge(party_min: 1, party_max: 10))
      %li= link_to "10〜20人", search_listings_path(keeped_query.merge(party_min: 10, party_max: 20))
      %li= link_to "20人以上", search_listings_path(keeped_query.merge(party_min: 20))
.ls-sidebar-legend
  %h5 予算
.ls-sidebar
  .ls-sidebar-body
    %ul
      %li= link_to "〜1000円", search_listings_path(keeped_query.merge(price_max: 1000, price_min: 0))
      %li= link_to "1000円〜2000円", search_listings_path(keeped_query.merge(price_max: 2000, price_min: 1000))
      %li= link_to "3000円〜4000円", search_listings_path(keeped_query.merge(price_max: 4000, price_min: 3000))
      %li= link_to "5000円〜", search_listings_path(keeped_query.merge(price_min: 5000))
.ls-sidebar-legend
  %h5 部屋タイプ
.ls-sidebar
  .ls-sidebar-body
    %ul
      %li= link_to "全て", search_listings_path(keeped_query.delete_if{|k,v| k == "category"})
      %li= link_to "個室貸切", search_listings_path(keeped_query.merge(category: :private))
      %li= link_to "パーテーション仕切り", search_listings_path(keeped_query.merge(category: :partition))
      %li= link_to "共同スペース(仕切りなし)", search_listings_path(keeped_query.merge(category: :co))
      %li= link_to "スタジオ", search_listings_path(keeped_query.merge(category: :studio))
.ls-sidebar-legend
  %h5 設備
.ls-sidebar
  .ls-sidebar-body
    %ul
      %li= link_to "全て", 
        search_listings_path(keeped_query.merge(equipment_id: ""))
      = form_tag search_listings_path, method: :get, class: "form" do
        = hidden_field_tag :prefecture, keeped_query[:prefecture]
        = hidden_field_tag :neighborhood, keeped_query[:neighborhood]
        = hidden_field_tag :station, keeped_query[:station]
        = hidden_field_tag :price_min, keeped_query[:price_min]
        = hidden_field_tag :price_max, keeped_query[:price_max]
        = hidden_field_tag :category, keeped_query[:category]
        = hidden_field_tag :usage_id, keeped_query[:usage_id]
        = hidden_field_tag :party_min, keeped_query[:party_min]
        = hidden_field_tag :party_max, keeped_query[:party_max]
        - Equipment.list.each do |eq|
          = label_tag eq.id, eq.name, class: "check_box"
          = check_box_tag eq.id, eq.id, keeped_query[:equipment_id].try(:include?, eq.id.to_s), name: "equipment_id[]"
        = submit_tag '表示', class: "button"

.ls-sidebar-legend
  %h5 用途
.ls-sidebar
  .ls-sidebar-body
    %ul
      %li= link_to "全て", search_listings_path(keeped_query.delete_if{|k,v| k == "usage_id"})
      - Usage.list.each do |usage|
        %li= link_to usage.name, search_listings_path(keeped_query.merge(usage_id: usage.id))

= render "partials/listing_search/search_sidebar"
