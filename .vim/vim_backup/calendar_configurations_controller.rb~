class Provider::CalendarConfigurationsController < ProviderApplicationController
  include ProvidersListing
  before_action :set_listing
  layout "provider/after_sign_in"

  def new
    @listing.build_1w_calendar_configurations
  end

  def edit_all
    @calendar_configurations = @listing.calendar_configurations
  end

  def setup
    CalendarConfiguration.setup(@listing, listing_params)
    redirect_to([:provider, @listing],
                notice: "スペースを登録しました。数日内にSpaceeからご連絡いたします。")
  end

  def update_all
    CalendarConfiguration.transaction do
      @listing.update!(listing_params)
    end
    redirect_to edit_all_provider_listing_calendar_configurations_url(@listing),
    notice: "更新しました"
  end

  private

  def listing_params
    params.require(:listing).
      permit(calendar_configurations_attributes: [
               :id, :price_plan_id, :wday, :is_holiday, :is_open, :open_at, :close_at
             ])
  end
end
