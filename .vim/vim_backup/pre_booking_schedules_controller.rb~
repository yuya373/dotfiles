class Provider::PreBookingSchedulesController < ProviderApplicationController
  include ProvidersListing
  before_action :set_listing
  layout "provider/after_sign_in"

  def edit
    @listing = current_provider.listings.find params[:listing_id]
    @pre_booking = @listing.pre_bookings.find params[:id]
  end

  def update
    @listing = current_provider.listings.find params[:listing_id]
    @pre_booking = PreBooking.extend_time(@listing,
                                          params[:id], params[:extend_minutes].to_i)
    if @pre_booking
      flash[:notice] = "延長しました"
    else
      flash[:error] = "延長時間の短縮はできません"
    end
    redirect_to edit_provider_listing_pre_booking_schedule_path(@listing, @pre_booking)
  rescue ActiveRecord::RecordNotFound => e
    logger.error e
    flash[:error] = "空室がないため延長できません"
    redirect_to edit_provider_listing_pre_booking_schedule_path(@listing, @pre_booking)
  end
end
